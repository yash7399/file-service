ExecutorService filePool = Executors.newFixedThreadPool(3); // tune 3â€“5

List<Future<?>> futures = new ArrayList<>();

for (FileConfig record : entry.getValue()) {

    futures.add(filePool.submit(() -> {

        String fileName = util.getFileNameWithDate(
                record.getFilename(),
                record.getTime(),
                args[0]
        );

        try {
            File_Transfer_Test.transfer(
                    sftp,
                    entry.getKey(),
                    share,
                    fileName,
                    record.getShare(),
                    record.getSource(),
                    record.getDestination(),
                    record.getTime(),
                    department,
                    missingFiles,
                    transferedFiles
            );

        } catch (Exception e) {
            log.error("Transfer failed {}", fileName, e);
        }
    }));
}

for (Future<?> f : futures) {
    f.get();
}

filePool.shutdown();