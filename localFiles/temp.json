private void copyFile(String serverCode, ChannelSftp sftp, String connectionCode, DiskShare share,
			String smbShareName, String fileName, String sftpFilePath, String destinationPath, int time,
			String department, Map<String, List<String>> missingFiles, Map<String, List<String>> transferedFiles)
			throws SftpException, IOException {
		
		System.out.println("Inside copy file");

		String[] folders = destinationPath.split("/");
		String currentPath = "";
		for (String folder : folders) {
			currentPath = currentPath.isEmpty() ? folder : currentPath + "/" + folder;
			try {
				share.mkdir(currentPath);
			}
			catch(SMBApiException e) {
				if(e.getStatus()!=NtStatus.STATUS_OBJECT_NAME_COLLISION) {
					log.info("Error in making folder "+e);
				}
			}
		}

		String localTempDir = GlobalConstants.local_folder_temporary;
		if (localTempDir == null) {
			log.info("Local folder is null");
			return;
		}

		String localFilePath = localTempDir + "//" + fileName;

		boolean downloaded = true;

		try {
			java.nio.file.Files.createDirectories(java.nio.file.Paths.get(localTempDir));
		} catch (IOException dirEx) {
			System.err.println("Failed to create local temp directory: " + dirEx.getMessage());
			log.error("Failed to create local temp directory: " + dirEx.getMessage(), dirEx);
		}

		try {

//			System.out.println(sftpFilePath);
//
//			try (InputStream inputStream = sftp.get(sftpFilePath);
//					OutputStream localOutputStream =new BufferedOutputStream(new FileOutputStream(localFilePath,false),1024*1024) ) {
//
//				byte[] buffer = new byte[8*1024*1024];
//				int bytesRead;
//				while ((bytesRead = inputStream.read(buffer)) != -1) {
//					localOutputStream.write(buffer, 0, bytesRead);
//				}
//				localOutputStream.flush();
//				downloaded = true;
//				System.out.println("Downloaded to local: " + localFilePath);
//
//				    log.info(fileName + " downloaded locally to  " + localFilePath);
//
//			}

			ChannelSftp sftp2 = SFTPConnection.connect(serverCode);

			System.out.println(localFilePath);
			
			System.out.println("******************************************");
			System.out.println("Password "+getProperty(serverCode + ".password"));
			System.out.println("user "+getProperty(serverCode + ".user"));
			System.out.println("ip "+getProperty(serverCode + ".ip"));
			System.out.println("port "+getProperty(serverCode + ".port"));
			System.out.println(destinationPath);

			ProcessBuilder pb = new ProcessBuilder(
					"sshpass", 
					"-p", 
					getProperty(serverCode + ".password"), 
					"sftp",
//					"-i",getProperty(serverCode+".privateKey"),
					"-P",getProperty(serverCode + ".port"),
					"-o", "StrictHostKeyChecking=no",
					"-o", "Compression=no",
					getProperty(serverCode + ".user") + "@" + getProperty(serverCode + ".ip") + ":" + sftpFilePath + " "
							+ localFilePath);

			pb.redirectErrorStream(true);

			Process process = pb.start();

			int exitCode = process.waitFor();

			String stderr=new String(process.getErrorStream().readAllBytes());
			String sout = new String(process.getInputStream().readAllBytes());
			System.out.println(sout);
			System.out.println(stderr);
			
			if (exitCode != 0) {
				downloaded = false;
				log.error("Failed to download file from SFTP server to local");
				log.error(sout);

			}
			else {
				log.info("File has been downloaded finally to the local folder");
			}
			
//			System.exit(1);

			Session smb = NASConnection.connect();
			
			ProcessBuilder pb3 = new ProcessBuilder(
					"mkdir","-p","/nseit"+destinationPath
					);

			pb3.redirectErrorStream(true);

			Process process3 = pb3.start();

			int exitCode3 = process3.waitFor();

//			String stderr=new String(process.getErrorStream().readAllBytes());
			String sout3 = new String(process3.getInputStream().readAllBytes());
			System.out.println(sout3);
			
			if (exitCode3 != 0) {
				log.error("Failed to download file from local to smb");
				log.error(sout3);
			}
			
			System.out.println("*************cp one1****************************");
			
			System.out.println("local file path "+localFilePath);
			System.out.println("Destination path "+destinationPath);
			
			System.out.println("Command is "+"cp "+localFilePath + " " + "/nseit"+destinationPath);

			ProcessBuilder pb2 = new ProcessBuilder(
					"cp",localFilePath,"/nseit"+destinationPath
					);

			pb2.redirectErrorStream(true);
			
			pb2.inheritIO();

			Process process2 = pb2.start();

			int exitCode2 = process2.waitFor();

			String stderr2=new String(process2.getErrorStream().readAllBytes());
			String sout2 = new String(process2.getInputStream().readAllBytes());
			System.out.println(sout2);
			System.out.println(stderr2);
			if (exitCode2 != 0) {
				
				log.error("Failed to download file from local to smb");
				log.error(sout2);

			}
			else {
				log.info("downloaded to the ");
			}

			deleteLocal(localFilePath);
//			if (downloaded) {
//				try (InputStream localInputStream = new FileInputStream(localFilePath);
//						
//						com.hierynomus.smbj.share.File smbFile = share.openFile(destinationPath + "\\" + fileName,
//								EnumSet.of(AccessMask.FILE_WRITE_DATA),
//								EnumSet.of(FileAttributes.FILE_ATTRIBUTE_NORMAL),
//								EnumSet.noneOf(SMB2ShareAccess.class),
//								SMB2CreateDisposition.FILE_OVERWRITE_IF, null);
//						
//						OutputStream smbOutputStream =new BufferedOutputStream(smbFile.getOutputStream(),16*1024*1024) ) {
//					byte[] buffer = new byte[16*1024*1024];
//					int bytesRead;
//					while ((bytesRead = localInputStream.read(buffer)) != -1) {
//							smbOutputStream.write(buffer, 0, bytesRead);
//					} 
//					smbOutputStream.flush(); 
//
//					System.out.println("Uploaded to SMB: " + destinationPath + "\\" + fileName);
//
//					log.info("Uploaded to SMB: " + destinationPath + "\\" + fileName);
//
//				}
//			}


		}
//		catch (SftpException e) {
//			
//			deleteLocal(localFilePath);
//			
//			if (e.id == ChannelSftp.SSH_FX_PERMISSION_DENIED) {
//				System.out.println("Error in transfering file : " + e.getMessage());
//				log.error("Error in transfering file : " + e.getMessage());
//				throw e;
//			}
//			else {
//				log.error(e);
//				sftp=SFTPConnection.connect(connectionCode);
//				Session smb=NASConnection.connect();
//				share=(DiskShare) smb.connectShare(smbShareName);
//			}
//		} 
		catch (IOException e) {

			deleteLocal(localFilePath);

			String msg = e.getMessage() != null ? e.getMessage().toLowerCase() : "";

			if (msg.contains("access is denied") || msg.contains("permission denied") || msg.contains("being used")) {
				System.out.println("Error in transfering file :  " + e.getMessage());
				log.error("Error in transfering file : " + e.getMessage());
				throw e;
			} else if (msg.contains("disk full") || msg.contains("no space left") || msg.contains("not enough space")
					|| msg.contains("status_disk_fullY")) {
				log.error("Disk size full");
				log.error(e);
				emails.connectionIssue();
			} else {
				log.error(e);
				sftp = SFTPConnection.connect(connectionCode);
				Session smb = NASConnection.connect();
				share = (DiskShare) smb.connectShare(smbShareName);
			}

		} catch (Exception e) {
			deleteLocal(localFilePath);

			log.info(e);
			e.printStackTrace();
			emails.connectionIssue();
		}

	}
