import React, { useState, useEffect } from "react";
import "./App.css";

const App = () => {
  const [formData, setFormData] = useState({
    vendorName: "",
    ipAddress: "",
    port: "",
    status: "",
    mobileNumber: "",
    registrationDate: "",
    address: {
      addressLine1: "",
      addressLine2: "",
      city: "",
      state: "",
      zip: "",
      country: ""
    },
    billingAddress: {
      addressLine1: "",
      addressLine2: "",
      city: "",
      state: "",
      zip: "",
      country: ""
    },
    billingSameAsAddress: false,
    segment: [],
    captcha: "",
  });

  const subscriptionTypeValue = {
    "Equity (CM)": ["Real Time/BOD", "EOD Bhavcopy"],
    "F/O": ["Real Time/BOD", "EOD Bhavcopy", "Historicla Trade Data"],
    "Indices": ["Real Time/BOD", "EOD Bhavcopy"]
  };

  const packetCodeValue = {
    "Equity (CM)": ["CN, PN"],
    "F/O": ["FN/FP"],
    "Indices": ["CX"]
  };

  const levelValue = {
    "Equity (CM)": ["Level 1", "Level 2", "Level 3"],
    "F/O": ["Level 1", "Level 2"],
    "Indices": []
  };

  const countries = ["India", "USA", "UK", "UAE", "Singapore", "Other"];
  const states = ["Maharashtra", "Delhi", "Gujarat", "Karnataka", "Tamil Nadu", "Punjab", "Other"];

  const segmentOptions = [
    { id: "equity", value: "Equity (CM)", label: "Equity (CM)" },
    { id: "fo", value: "F/O", label: "F/O" },
    { id: "indices", value: "Indices", label: "Indices" }
  ];

  const [segmentData, setSegmentData] = useState({});

  const handleSegmentChange = (value, checked) => {
    const currentSegments = formData.segment || [];

    if (checked) {
      setFormData({
        ...formData,
        segment: [...currentSegments, value]
      });
      setSegmentData(prev => ({
        ...prev,
        [value]: {
          subscriptionType: "",
          packetCode: "",
          levels: ""
        }
      }));
    } else {
      const newSegments = currentSegments.filter(segment => segment !== value);
      setFormData({
        ...formData,
        segment: newSegments
      });
      setSegmentData(prev => {
        const newData = { ...prev };
        delete newData[value];
        return newData;
      });
    }
  };

  const handleSegmentFieldChange = (segment, field, value) => {
    setSegmentData(prev => ({
      ...prev,
      [segment]: {
        ...prev[segment],
        [field]: value
      }
    }));
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    if (name.startsWith("address.") || name.startsWith("billingAddress.")) {
      const field = name.split(".")[1];
      const section = name.split(".")[0];
      setFormData(prev => ({
        ...prev,
        [section]: {
          ...prev[section],
          [field]: value
        }
      }));
    } else {
      setFormData({ ...formData, [name]: value });
    }
  };

  const handleBillingSameChange = (e) => {
    const checked = e.target.checked;
    setFormData(prev => ({
      ...prev,
      billingSameAsAddress: checked,
      ...(checked ? {
        billingAddress: {
          ...prev.address
        }
      } : {
        billingAddress: {
          addressLine1: "",
          addressLine2: "",
          city: "",
          state: "",
          zip: "",
          country: ""
        }
      })
    }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    console.log("Form Data:", formData);
    console.log("Segment Data:", segmentData);
    alert("Form submitted successfully!");
  };

  return (
    <div className="form-container">
      <div className="form-header">
        <a href="https://ncdex.com/" target="_blank">
          <img className="form-header-img" src="https://globalprimenews.com/wp-content/uploads/2019/11/IMG-20191114-WA0010-1024x434.jpg" alt="NCDEX Logo" />
        </a>
        <h4 className="form-title">Data Request Form - CM</h4>
      </div>

      <form onSubmit={handleSubmit}>
        <section className="form-section">
          <h3>Vendor Information</h3>
          <div className="form-grid">
            <label>
              <span className="section-part-heading">Vendor Name <span className="star">*</span></span>
              <input
                type="text"
                name="vendorName"
                value={formData.vendorName}
                onChange={handleChange}
                required
              />
            </label>
            <label>
              <span className="section-part-heading">IP Address <span className="star">*</span></span>
              <input
                type="text"
                name="ipAddress"
                value={formData.ipAddress}
                onChange={handleChange}
                required
              />
            </label>
            <label>
              <span className="section-part-heading">Port <span className="star">*</span></span>
              <input
                type="text"
                name="port"
                value={formData.port}
                onChange={handleChange}
                required
              />
            </label>
            <label>
              <span className="section-part-heading">Status <span className="star">*</span></span>
              <select
                name="status"
                value={formData.status}
                onChange={handleChange}
              >
                <option value="">Select</option>
                <option>Active</option>
                <option>Inactive</option>
              </select>
            </label>
          </div>
        </section>

        <section className="form-section">
          <h3>Vendor Contact Details</h3>
          <div className="form-grid">
            <label>
              <span className="section-part-heading">Mobile Number <span className="star">*</span></span>
              <input
                type="text"
                name="mobileNumber"
                value={formData.mobileNumber}
                onChange={handleChange}
                required
              />
            </label>
            <label>
              <span className="section-part-heading">Registration Date <span className="star">*</span></span>
              <input
                type="date"
                name="registrationDate"
                value={formData.registrationDate}
                onChange={handleChange}
                required
              />
            </label>
          </div>

          {/* Address Section */}
          {/* Address Section */}
          <div className="address-section">
            <div className="address-heading">
            <span className="section-part-heading">üìç Address</span>

            </div>
            <div className="form-grid">
              {/* Full width Address Lines */}
              <div className="address-line-fullwidth">
                <label>
                  <span>Address Line 1</span>
                  <input
                    type="text"
                    name="address.addressLine1"
                    value={formData.address.addressLine1}
                    onChange={handleChange}
                    placeholder="Address Line 1"
                  />
                </label>
              </div>

              <div className="address-line-fullwidth">
                <label>
                  <span>Address Line 2</span>
                  <input
                    type="text"
                    name="address.addressLine2"
                    value={formData.address.addressLine2}
                    onChange={handleChange}
                    placeholder="Address Line 2"
                  />
                </label>
              </div>

              {/* Rest of fields in grid */}
              <div className="address-grid">
                <label>
                  <span>City</span>
                  <input
                    type="text"
                    name="address.city"
                    value={formData.address.city}
                    onChange={handleChange}
                    placeholder="City"
                  />
                </label>
                <label>
                  <span>State</span>
                  <input
                    name="address.state"
                    value={formData.address.state}
                    onChange={handleChange}
                    placeholder="State"
                  />
                </label>
                <label>
                  <span>Zip</span>
                  <input
                    type="text"
                    name="address.zip"
                    value={formData.address.zip}
                    onChange={handleChange}
                    placeholder="Zip Code"
                  />
                </label>
                <label>
                  <span>Country</span>
                  <input
                    name="address.country"
                    value={formData.address.country}
                    onChange={handleChange}
                    placeholder="Country"
                  />
                </label>
              </div>
            </div>
          </div>

          {/* Same structure for Billing Address */}
          <div className="address-section">
            <div className="billing-header">
              <span className="section-part-heading">üí≥ Billing Address</span>
              <label className="same-address-checkbox">
                <input
                  type="checkbox"
                  checked={formData.billingSameAsAddress}
                  onChange={handleBillingSameChange}
                />
                <span>Same as Address</span>
              </label>
            </div>

            {!formData.billingSameAsAddress && (
              <div className="form-grid">
                <div className="address-line-fullwidth">
                  <label>
                    <span>Address Line 1</span>
                    <input
                      type="text"
                      name="billingAddress.addressLine1"
                      value={formData.billingAddress.addressLine1}
                      onChange={handleChange}
                      placeholder="Address Line 1"
                    />
                  </label>
                </div>
                <div className="address-line-fullwidth">
                  <label>
                    <span>Address Line 2</span>
                    <input
                      type="text"
                      name="billingAddress.addressLine2"
                      value={formData.billingAddress.addressLine2}
                      onChange={handleChange}
                      placeholder="Address Line 2"
                    />
                  </label>
                </div>
                <div className="address-grid">
                  <label>
                    <span>City</span>
                    <input type="text" name="billingAddress.city" value={formData.billingAddress.city} onChange={handleChange} placeholder="City" />
                  </label>
                  <label>
                    <span>State</span>
                    <input name="billingAddress.state" value={formData.billingAddress.state} onChange={handleChange} placeholder="State" />
                  </label>
                  <label>
                    <span>Zip</span>
                    <input type="text" name="billingAddress.zip" value={formData.billingAddress.zip} onChange={handleChange} placeholder="Zip Code" />
                  </label>
                  <label>
                    <span>Country</span>
                    <input name="billingAddress.country" value={formData.billingAddress.country} onChange={handleChange} placeholder="Country" />
                  </label>
                </div>
              </div>
            )}
          </div>

        </section>

        <section className="form-section">
          <h3>Data Request Details</h3>
          <div className="form-grid">
            <label className="checkbox-group">
              <span className="section-part-heading">Segment <span className="star">*</span></span>
              <div className="checkbox-container">
                {segmentOptions.map((option) => (
                  <label key={option.id} className="checkbox-label">
                    <span>{option.label}</span>
                    <input
                      type="checkbox"
                      value={option.value}
                      checked={formData.segment.includes(option.value)}
                      onChange={(e) => handleSegmentChange(option.value, e.target.checked)}
                    />
                  </label>
                ))}
              </div>
            </label>
          </div>

          {formData.segment.map((segment) => (
            <div key={segment} className="segment-fields">
              <h5>{segment} Details</h5>
              <div className="form-grid">
                <label>
                  <span className="section-part-heading">Subscription Type <span className="star">*</span></span>
                  <select
                    value={segmentData[segment]?.subscriptionType || ""}
                    onChange={(e) => handleSegmentFieldChange(segment, "subscriptionType", e.target.value)}
                  >
                    <option value="">Select</option>
                    {subscriptionTypeValue[segment]?.map((value) => (
                      <option key={value} value={value}>{value}</option>
                    ))}
                  </select>
                </label>

                <label>
                  <span className="section-part-heading">Packet Code <span className="star">*</span></span>
                  <select
                    value={segmentData[segment]?.packetCode || ""}
                    onChange={(e) => handleSegmentFieldChange(segment, "packetCode", e.target.value)}
                  >
                    <option value="">Select</option>
                    {packetCodeValue[segment]?.map((value) => (
                      <option key={value} value={value}>{value}</option>
                    ))}
                  </select>
                </label>

                {segment !== "Indices" && (
                  <label>
                    <span className="section-part-heading">Levels <span className="star">*</span></span>
                    <select
                      value={segmentData[segment]?.levels || ""}
                      onChange={(e) => handleSegmentFieldChange(segment, "levels", e.target.value)}
                    >
                      <option value="">Select</option>
                      {levelValue[segment]?.map((value) => (
                        <option key={value} value={value}>{value}</option>
                      ))}
                    </select>
                  </label>
                )}
              </div>
            </div>
          ))}

          <div className="captcha-section">
            <label>
              <span className="section-part-heading">Enter Captcha <span className="star">*</span></span>
              <div className="captcha-box">
                <input
                  type="text"
                  name="captcha"
                  value={formData.captcha}
                  onChange={handleChange}
                  required
                />
                <span className="captcha-code">U9pO5</span>
                <button type="button" className="reload-btn">Reload</button>
              </div>
            </label>
          </div>
        </section>

        <p className="note">Note: All fields marked * are mandatory.</p>

        <div className="form-buttons">
          <button type="submit" className="submit-btn">Submit</button>
          <button type="button" className="cancel-btn">Cancel</button>
        </div>
      </form>
    </div>
  );
};

export default App;
